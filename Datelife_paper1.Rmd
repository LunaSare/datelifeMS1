---
output: pdf_document
fontsize: 12pts
textalign: left  # this does not work...
geometry: margin = 1in
bibliography: library_red.bib
csl: systematic-biology.csl
link-citations: yes
# indent: true # this works
# header-includes:
#    - \setlength\parindent{24pt}  # this works too, but I'm gonna indent manually with 4 spaces
# nope, 4 spaces indents are not recognized, they do something else
linestretch: 2
header-includes:
    - \usepackage[left]{lineno}
    - \linenumbers
---
```{r eval = TRUE, echo = FALSE}
source("Datelife_paper1_global.R")
```

Running head: DATELIFE: REVEALING THE DATED TREE OF LIFE <!--MAX 50 CHARACTERS, ALL CAPITALS-->

Title: DateLife: Leveraging databases and analytical tools to reveal the dated Tree of Life

Authors: Luna L. Sánchez-Reyes^1^, Brian C. O’Meara^1^

Correspondence address:

1. *Department of Ecology and Evolutionary Biology, University of Tennessee, Knoxville, 425 Hesler Biology Building, Knoxville, TN 37996, USA*

Corresponding authors: sanchez.reyes.luna@gmail.com, bomeara@utk.edu


\newpage

**abstract.-** Here goes the abstract.

**Keywords:** Tree; Phylogeny; Scaling; Open; Ages; Congruify; Supertree;


\newpage

<!--INTRODUCTION-->
Supersmart is an open tool but not easy to use, still requires a lot of curation and knowledge.

<!--INTRODUCTION: 1st paragraph: general statement that the field knows to be true and important-->
Time of lineage divergence<!--alt lineages: named biological entities, taxon ages?-->
constitutes in many ways the fundamental/main knowledge necessary for evolutionary
understanding.
<!--Along with phylogenetic relationships, it is the most important piece of information
allowing to test alternative evolutionary hypothesis in many areas of research,
from developmental to ecological questions.
Along with migration rates and patterns, it is fundamental to test biogeographical
hypothesis-->
Coupled to species number and distribution, it is the main information necessary
for the study of diversification processes (i.e., the tempo and mode of speciation
and extinction),
<!-- crucial/vital/critical/essential  -->central for the understanding of how biodiversity
patterns are shaped across space, time and clades [@Morlon2014].
Evolutionary understanding also relies on comparative studies, for which knowing
the time context for all life is crucial. Efforts to have a whole tree of life have
been great and here are some examples.
<!--INTRODUCTION: 2nd paragraph: important advances in the field-->
In the past two decades, the possibility to obtain good quality DNA sequences
<!-- from a wide variety of organisms became a reality, which,  -->
coupled to methodological developments in phylogenetic and dating inference, allowed
the application of molecular dating methods on a very large amount and diversity
of organisms, greatly increasing the quantity of<!--organisms with--> data on taxon
ages across the tree of life.
<!-- figure showing growth on studies with age data from references table from ttol-->
To date, there is a large amount of both fossil and molecular-based data on taxon
ages and phylogenetic relationships in public repositories such as Dryad, TreeBASE
and Open Tree of Life (OToL).
OToL alone holds more than 200 chronograms. <!--cache updated jan 15 2018
devtools::load_all(pkg = "~/Desktop/datelife")
length(opentree_chronograms$trees) names(opentree_chronograms)
-->
<!--How many trees? How many dated trees?-->
Methods to include living and fossil lineages are in continued development and increased
usage by the community<!--total evidence and revbayes (fossilized birth-death)-->,
which coupled to better sharing data practices, are greatly contributing to the
accumulation in number and type of available data on taxon ages.

<!--INTRODUCTION: 3rd paragraph: problems associated-->
The TimeTree project [@Hedges2006; @Hedges2015; @Kumar2017] has aggregated chronograms
from 3,163 studies, encompassing 97,085 species [@Kumar2017], and continues to grow.
However, even in this gold standard resource, the included taxa only encompass between
0.097 and 3.236% of total species diversity (following taxonomic expert opinion
on the global, extant species numbers, which ranges from 3 to 100 million species
[Mayr2010; Moran2011]). One advantage of TimeTree is that it includes taxa from
across the tree of life, versus more specialized chronograms focusing on plants
[PHYLOMATIC], birds [JETZ ET AL BIRDTREE.ORG], and other groups. Users can choose
between a web interface or a mobile app to receive information on divergence times
for the evolutionary history of a lineage, pairs of taxa, all lineages within a
taxon, or a list of taxa. As a science communication tool, TimeTree project is
very powerful: it has a friendly graphical interface, with informative and colorful
outputs, that allows the general public to satisfy curiosity regarding a particular
organism of interest or group of them. It is of limited utility for scientific
studies, however. The thousands of trees that have been entered are unavailable
for examination or reuse; according to the creators (see TimeTree web FAQ), methods
for allowing data downloading have been under discussion for the past several years
yet the primary data remain closed. Moreover, there is no Application Programming
Interface (API) allowing programmatic access to any data, greatly impairing the
possibility of large-scale, automated data-mining, which is not allowed under TimeTree
website's terms of use. The nearly hundred thousand taxon summary chronogram generated
from TimeTree resources is not available with its publication [@Kumar2017] or the
TimeTree website, though the still substantial chronogram from a previous publication
[@Hedges2015] was made available at OToL.
<!--What led to datelife development?
Describe public and research necessities covered by datelife
It is important to use available data on time frame of lineage origin:
To know the state of dating for a group of interest:
What range of estimated ages exist already? Are fossil and molecular
time frames coherent? (e.g., [@Magallon2015c]).
To construct a time tree of life.
For science communication, improve scientific discussions, time-framing
other events of importance in other research areas.
Comparative method: autocorrelation (phylogenetic relatedeness) corrections, phylogenetic signal
-->

<!--INTRODUCTION: 4th paragraph-->
Despite its great importance, analytical tools to summarize available information
on taxon ages for the scientific community are still lacking.
We identified several aspects that might have so far delayed the exploitation of
existing data. First, original chronograms available publicly are scattered across
various repositories (otol tree store, dryad, treebase, journals supplementary data)
usually with different formats too.
Second, lineage names due to taxonomic idiosincracy can be different among studies
and manual curation of that is usually necessary.
Third, data curation
Recent advances on this area (e.g., supersmart<!--and, which others?-->) aim to:
Generate new dates using all available DNA sequence information;
Perform one global analysis using all available information;
Problems or downsides: This might be time consuming for large groups and a lot of
data curation and knowledge on the group of interest is still necessary. For example,
<!--General issues with dating techniques:--> choosing correct fossils for calibration
requires a lot of expertise and knowledge on the group. An incorrect use of fossils
can generate severe bias in dating results [@Sauquet2012c].
<!--Data curation is necessary at some point (is this always true?)-->
Hence, data curation is still an important part of any biological study. The research
community considers it as an important or even crucial step before data analysis.
Hence, automated processes for large data analysis are frequently received with skepticism.

DateLife palliates this by only using information available from already published
studies, which are ideally constructed using robust information, such as sequence
data and thoughtfully curated fossil calibrations.
<!--Data curation is largely based on taxonomic knowledge; or at least on the interplay between taxonomy and phylogenetics-->
<!--Importance of datelife:-->

<!--INTRODUCTION: 5th paragraph: Goal, objectives and predictions-->
Rapidly increasing data on time of lineage divergence both from molecular and paleontological studies; the increasing importance of use of these data in distant areas of research, often not specialized enough to rapidly obain data on their own; and the lack of an open (both the data sources and the code underlying the analyses) easy to use tool
inspired the development of a prototype `DateLife` service over a series
of phylotastic hackathons [@Stoltzfus2013] at the National Evolutionary Synthesis Center.
In this paper we present the first formal description of `DateLife`, featuring an improved database of chronograms, more methods to summarize trees, and new functions to visualize data, as well as comparisons of summary trees.
DateLife is the main service for scaling phylogenetic trees in Phylotastic! system
[@Stoltzfus2013] <!--to construct phylogenetic trees on the fly [http://phylotastic.org/].-->
It can be used through an R package <link to documentation>, a web interface
(<http://www.datelife.org/query/>) and an API<!--(still not up, right?)-->.

<!--DESCRIPTION of Datelife-->
<span style="font-variant:small-caps;">
Description
</span>

<!--(BOLD and OToL species names, are they homogeneous/standardized?-->
The basic `DateLife` workflow is shown in `r fig_workflow_main` and consists of:

1) A user providing as input at least two taxon names, either as tip labels on a tree, or as a simple comma separated character string. The tree can be in newick or phylo format, and can be with or without branch lengths.
2) `DateLife` then performs a search across its database of peer reviewed and curated chronograms; identifies and gets source trees with at least two matching input names; drops unmatching taxa from positively identified source trees; and finally transforms each source tree to a patristic matrix named by the citation of the original study. This format facilitates and greatly speeds up all further analyses and summary algorithms.
3) The user can obtain different types of summaries from the source data including: a) all source chronograms, b) mrca ages of source chronograms, c) citations of studies where source chronograms were originally published, d) a summary table with all of the above, e) a single summary tree of all source chronograms, and f) a report of succesful matches per input taxon name across source chronograms.
4) At this point, users can choose to use all or some source data as calibration points to date a tree of their own making or choosing. <!--, a taxonomic tree-->
5) Users can also simulate age and/or phylogenetic data of input taxa not found in the database. A variety of algorithms are available for this purpose.
6) Finally, users can easily view results graphically as well as construct their own graphs using inbuilt `DateLife` graphic generators.

<!--To perform the former tasks:-->
`DateLife`'s chronogram database is currently built from Open Tree of Life (OToL)'s
[@Hinchliff2015] tree repository. Among currently existing repositories (e.g., TreeBAse,
Dryad), OToL's metadata rich tree store is the only one meeting the requirements
for proper/accurate automatized handling of trees.
Input taxon names accepted by `DateLife` are binomial species names or clades.
<!--common names (implemented yet?)-->
Taxon searches are performed at the species level, so when input names correspond
to higher clades,
`DateLife` pulls all accepted species names within the
clade from OToL's reference taxonomy to perform the search.
Currently, searches at the infrapsecies level are not allowed, so input names belonging to subspecies or any other infraspecific category are treated
as species.
`DateLife` also processes input names with the taxon name resolution service (TNRS),
<!--which "corrects misspelled names and authorities, standardizes variant spellings,
and converts nomenclatural synonyms to accepted names" (Boyle et al. 2013)-->
which corrects potentially misspelled names and typos, and standardizes variation
in spelling and synonyms <!--to a taxonomic reference of users choosing, default
to otol taxonomy -->[@Boyle2013], increasing the probability to correctly find the
queried
taxa in `DateLife`'s chronogram database.

Source chronogram summary tree can be assembled using the Super Distance Matrix
(SDM) supertree construction approach [@Criscuolo2006] or using the median of branch
lengths and the hierarchical clustering method<!-- of ttol-->. <!--Also, I discovered the median gives non ultrametric trees... but I thonk it is fixed now, check it!).-->
Tree dating and simulation options are performed with various algorithms:
Branch Length Adjuster (BLADJ) is a simple algorithm to distribute ages of undated
nodes evenly, which minimizes age variance in the chronogram [@Webb2008].
PATHd8 is a non-clock, rate-smoothing method [@Britton2007] to date trees.
treePL, is a semi-parametric, rate-smoothing, penalized likelihood dating method
[@Smith2012].
MrBayes [@Huelsenbeck2001; @Ronquist2003] can be used when adding taxa at
random, following a reference taxonomy or a topological constraint. It draws ages
from a pure birth model, as implemented by Jetz and collaborators [-@Jetz2012].
To apply calibrations to a tree, th econgruification algorithm described in [@Eastman2013]
is used to find shared nodes between trees (congruent nodes).

To gather, process, and present information, `DateLife` builds up from functions
available in several R packages including rotl [@Michonneau2016], ape [@Paradis2004],
geiger [@Harmon2008], paleotree [@Bapst2012a], bold [@Chamberlain2018], phytools [@Revell2012],
taxize [@Chamberlain2013; @Chamberlain2018], phyloch [@Heibl2008], phylocomr [@Ooms2018]
and rphylotastic [@Omeara2019].

Details on each step are further developed in `DateLife`'s R package documentation
`datelife workflow` vignette at (<https://LINK>).


<!--**Benchmark: Testing DateLife computing performance**-->
<span style="font-variant:small-caps;">
Benchmark
</span>
<!-- Good to test 3 features on a package: performance, speed and scalability-->

`DateLife`'s code speed was tested on an Apple iMac
with one 3.4 GHz Intel Core i5 processor. <!--No multiprocessor tests were performed-->
We registered variation in computing time relative to number of input names
<!--number of chronograms in database--> and `DateLife` service.
Input processing increases roughly linearly with number of input taxon names, and
increases considerably if tnrs service is activated (`r fig_runtime_main`).
<!--
Speed with different number of input lineages and types of analysis:
-->
Results show that searching time increases linearly with number of input names and
number of chronograms in database.

Summarizing DateLife results processing times

Adding dates processing time

get_bold_otol_tree running time
<!-- test improvement in synthetic tree after using bold sequences. Is it really better resolved?-->

<!--
Speed of web interface and of r package (in computers with different capacities?)
-->
`DateLife`'s code performance was evaluated with a set of unit tests designed and
implemented with the R package testthat [@RCoreTeam2018]. These tests were run both
locally –using the devtools package [@RCoreTeam2018]– and on a public server –via
GitHub– using the continuous integration tool Travis CI (<//travis-ci.org>). At
present, unit tests cover around 30% (for now) of `DateLife`'s code (<https://codecov.io/gh/phylotastic/datelife>). <!-- unit test make code robust, verifiable, debuggable, -->


<!--**Biological example: Testing DateLife accuracy**-->
<span style="font-variant:small-caps;">
Biological example
</span>

Find a clade with at least one chronogram containing all clade's species.
(Penguins look good, but they are giving weird results in SDM)

Remove this chronogram from datelife Results.

Make sdm and median trees and Compare

add taxa with different methods and Compare

Use ltts to compare for now.
Fig. X2 shows comparison of available chronograms for Felidae species and chronograms
generated through DateLife

think of a test to compare trees, topology- and date-wise

<!--Bird (or reptile) chronograms, too long time...
finches is good
nothofagus
Look for all chronograms containing any birds
Or, look for chronograms containing small and old lineages
Determine which clade of birds has the more chronograms (have been dated
more times) and use that as biological example-->


<!--**Discussion/Conclusions** there is not a discussion section in this type of sys Bio contributions-->
<span style="font-variant:small-caps;">
Conclusions
</span>

Taxon ages are key to many areas of evolutionary studies: trait evolution, species
diversification, biogeography, macroecology and more. Obtaining these ages is difficult,
especially for those who want to use phylogenies but who are not systematists, or
do not have the time to develop the necessary knowledge and data curation skills
to produce new chronograms. Knowledge on taxon ages is also important for non-biological
studies and the non-academic community.
The combination of new analytical techniques, availability of more fossil and molecular
data, and better practices in data sharing has resulted in a steady accumulation
of chronograms in public and open databases such as Dryad, TreeBASE or Open Tree
of Life, for a large quantity and diversity of organisms. However, this information
remains difficult to synthesize for many biologists and the non-academic community<!-- or just non biologists-->.

<!--Potential applications shown here-->Here, we have shown that DateLife allows
an easy and fast obtention of all publicly available information on taxon ages,
which can be used to generate new data. <!--Potential applications not shown here-->
This information can be used to account for the effect of phylogenetic signal in
studies of trait evolution; to explore potential speciation and extinction dynamics
of interest within a clade; to obtain a time frame of biogeographical events; for
science communication and outreach, amongst others.
<!--Why you should use it-->Compared to similar platforms such as time tree of life
and supermart, it offers several advantages.
It is fast;
source data is completely open;
it requires no expert biological knowledge from users for any of its functionalities;
it allows exploration of alternative taxonomic and phylogenetic schemes;
it allows rapid exploration of the effect of alternative divergence time hypothesis;
it allows rapid synthesis in a number of different formats; <!-- we should add graphical options too-->
it facilitates reproducibility of analyses;

Improvements, short and long-term:
* fossils as calibrations: Using secondary calibrations can generate biased ages when using bayesian methods, mainly because we don't know what prior to give to secondary calibrations
[@Schenk2016].
* bayesian congruification
* topological congruification

Problems and caveats:
Not many databases, only OToL
Why TreeBase is not very useful for us? Be precise.



<!--**Availability**-->
<span style="font-variant:small-caps;">
Availability
</span>

DateLife is free and open source and it can be used through its current website
<http://www.datelife.org/query/>, or through Phylotastic!'s web portal <http://phylo.cs.nmsu.edu:3000/>.
RStudio's Shiny Server and the shiny package open infrastructure are used to maintain
the former. Also Docker.
DateLife can also be used locally through its R package. The stable version is available
for installation from the CRAN repository (<https://cran.r-project.org/package=datelife>)
using the command `install.packages(pkgs = "datelife")` from R. Development versions
are available from GitHub repository (<https://github.com/phylotastic/datelife>)
and can be installed using the devtools R package command `install_github("phylotastic/datelife")`.

<!--**Supplementary Material**-->
<span style="font-variant:small-caps;">
Supplementary Material
</span>

Supplementary material, including code files and
online-only appendices and vignettes, can be found in the GitHub
repository of the paper at (<https://github.com/LunaSare/datelife_paper1>) as well
as in the package vignettes <!-- Dryad also? since it is all in github already-->
and are also available from the Dryad Digital Repository at LINK.

<!--**Funding**-->
<span style="font-variant:small-caps;">
Funding
</span>

Funding was provided by NSF grant 1458603

NESCent

Open Tree of Life

University of Tennessee, Knoxville


<!--**Acknowledgements**-->
<span style="font-variant:small-caps;">
Acknowledgements
</span>
We thank colleagues (students and postdocs) at the O'Meara Lab at the University
of Tennesse Knoxville for suggestions, discussions and software testing.
The late National Evolutionary Synthesis Center (NESCent), which sponsored hackathons
that led to initial work on this project.
The Open Tree of Life project that provides the open, metadata rich repository of
trees used for DateLife.
The many scientists who publish their chronograms in an open, reusable form, and
the scientists who curate them for deposition in OpenTree.
The US National Science Foundation (NSF) for funding nearly all the above, in addition
to the ABI grant that funded this project itself.


<!--**References**-->
<span style="font-variant:small-caps;">
References
</span>
